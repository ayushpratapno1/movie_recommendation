{% comment %}
Enhanced Movie Card Macro - Consistent design across all sections
Usage: {% include 'movies/movie_card_macro.html' with movie=movie source=source badge_type=badge_type %}
{% endcomment %}

<div class="col-xxl-2 col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-4">
    <div class="card movie-card bg-dark text-white border-0 shadow-lg h-100 fade-in-up" 
         data-movie-id="{{ movie.id }}" 
         data-source="{{ source|default:'unknown' }}"
         data-movie-url="{% url 'movies:movie_detail' movie.id %}"
         style="cursor: pointer;">
        
        <div class="position-relative">
            <!-- Movie Poster -->
            {% if movie.get_poster_url %}
                <img src="{{ movie.get_poster_url }}" 
                     class="card-img-top" 
                     alt="{{ movie.title }}" 
                     style="height: 350px; object-fit: cover;"
                     loading="lazy">
            {% else %}
                <div class="card-img-top bg-gradient-dark d-flex align-items-center justify-content-center" 
                     style="height: 350px;">
                    <i class="fas fa-film fa-4x text-warning opacity-50"></i>
                </div>
            {% endif %}
            
            <!-- Rating Badge (Top Right) -->
            {% if movie.average_rating > 0 %}
                <div class="position-absolute top-0 end-0 m-2">
                    <span class="badge rating-badge rounded-pill px-2 py-1 shadow">
                        <i class="fas fa-star"></i> {{ movie.average_rating|floatformat:1 }}
                    </span>
                </div>
            {% endif %}
            
            <!-- Special Badge (Top Left) -->
            {% if badge_type %}
                <div class="position-absolute top-0 start-0 m-2">
                    {% if badge_type == 'recommended' %}
                        <span class="badge recommendation-badge rounded-pill px-2 py-1 shadow">
                            <i class="fas fa-bullseye"></i> For You
                        </span>
                    {% elif badge_type == 'trending' %}
                        <span class="badge trending-badge rounded-pill px-2 py-1 shadow">
                            <i class="fas fa-fire"></i> Trending
                        </span>
                    {% elif badge_type == 'new' %}
                        <span class="badge new-badge rounded-pill px-2 py-1 shadow">
                            <i class="fas fa-star-of-life"></i> New
                        </span>
                    {% elif badge_type == 'top' %}
                        <span class="badge bg-warning text-dark rounded-pill px-2 py-1 shadow">
                            <i class="fas fa-crown"></i> Top Rated
                        </span>
                    {% endif %}
                </div>
            {% endif %}
            
            <!-- Hover Overlay -->
            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center opacity-0 hover-overlay"
                 style="background: rgba(0, 0, 0, 0.7); transition: opacity 0.3s ease;">
                <div class="text-center">
                    <i class="fas fa-play-circle fa-3x text-white mb-2"></i>
                    <p class="text-white mb-0 fw-bold">View Details</p>
                </div>
            </div>
        </div>
        
        <!-- Card Body -->
        <div class="card-body p-3">
            <!-- Title -->
            <h6 class="card-title mb-2 text-truncate fw-bold" title="{{ movie.title }}">
                {{ movie.title }}
            </h6>
            
            <!-- Year and Duration -->
            <div class="d-flex justify-content-between align-items-center mb-2">
                <small class="text-muted">
                    <i class="fas fa-calendar-alt me-1"></i>{{ movie.release_year }}
                </small>
                {% if movie.duration_minutes %}
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>{{ movie.duration_minutes }}m
                    </small>
                {% endif %}
            </div>
            
            <!-- Genres -->
            <div class="genre-tags">
                {% for genre in movie.genres.all|slice:":3" %}
                    <span class="badge genre-tag rounded-pill me-1 mb-1">{{ genre.name }}</span>
                {% endfor %}
            </div>
            
            <!-- Quick Actions (Hidden by default, shown on hover) -->
            <div class="quick-actions mt-2 opacity-0" style="transition: opacity 0.3s ease;">
                <div class="btn-group w-100" role="group">
                    <button type="button" class="btn btn-outline-light btn-sm flex-fill watchlist-btn" 
                            data-movie-id="{{ movie.id }}" 
                            data-action="add"
                            title="Add to Watchlist">
                        <i class="fas fa-bookmark"></i>
                    </button>
                    <button type="button" class="btn btn-outline-warning btn-sm flex-fill rating-btn" 
                            data-movie-id="{{ movie.id }}" 
                            title="Rate Movie">
                        <i class="fas fa-star"></i>
                    </button>
                    <button type="button" class="btn btn-outline-info btn-sm flex-fill share-btn" 
                            data-movie-id="{{ movie.id }}" 
                            title="Share">
                        <i class="fas fa-share"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.movie-card:hover .hover-overlay {
    opacity: 1 !important;
}

.movie-card:hover .quick-actions {
    opacity: 1 !important;
}

.quick-actions .btn {
    transition: all 0.2s ease;
}

.quick-actions .btn:hover {
    transform: scale(1.05);
}

.watchlist-btn.added {
    background-color: #28a745 !important;
    border-color: #28a745 !important;
    color: white !important;
}

.watchlist-btn.added i {
    color: white !important;
}
</style>
